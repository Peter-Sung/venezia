# [PRD] Typing Game "Venezia"

## 1. 개요 (Overview)
본 문서는 대한민국의 '한메타자교사'라는 한글타자연습 프로그램에 포함된 인기게임 '베네치아'의 핵심 재미를 그대로 구현하는 것을 목표로 합니다. 
**PC 웹 브라우저 기반 게임**의 MVP(Minimum Viable Product) 버전의 PRD이며 
사용자는 추억의 윈도우 3.1 스타일 메뉴와 색상을 가진 시각적 화면안에서 게임을 즐길 수 있습니다.

## 2. 목표 (Goals)
- **핵심 게임 플레이 구현:** 단어가 떨어지고, 타이핑으로 맞추는 기본적인 게임 루프를 완성합니다.
- **성장 및 도전 경험 제공:** 단계별 난이도 상승(단어 복잡도, 하강 속도)과 점수 시스템을 통해 사용자의 도전 욕구를 자극합니다.
- **경쟁과 동기 부여:** 온라인 랭킹 시스템을 통해 자신의 순위를 확인하고, 다른 사용자와 경쟁하며 반복 플레이의 동기를 극대화합니다.
- **성취감 제공:** 명확한 단계 클리어 목표(시간 버티기)를 통해 단계를 격파해나가는 성취감을 부여합니다.

## 3. 사용자 흐름 (User Flow)
1.  **앱 실행**: 사용자가 게임을 시작하면 **웰컴 페이지**가 나타납니다.
2.  **(선택) 랭킹 조회**: '랭킹 조회' 버튼을 클릭하여 현재 랭킹을 확인합니다.
3.  **게임 준비**: 닉네임을 입력하고, 도전할 시작 단계를 선택한 뒤 **'게임 시작' 버튼**을 클릭합니다.
4.  **게임 플레이**:
    -   단어를 입력하며 12개의 블록이 모두 파괴되지 않도록 버팁니다.
    -   **단계 클리어**: 각 단계마다 주어진 시간(기본 1분)을 버티면 **'단계 전환 모달'**이 나타납니다.
    -   **5초 카운트다운 **남아있는 기회 블록을 그대로 유지한 채** 다음 단계가 시작됩니다.
5.  **게임 종료**: 12개의 블록이 모두 파괴되면, **온라인 랭킹이 포함된 게임 오버 모달**이 나타납니다.
6.  **다시하기 또는 메인으로**: '다시하기' 또는 '메인으로' 버튼을 클릭하여 **웰컴 페이지**로 돌아갑니다.

---

## 4. 상세 기능 명세 (Feature Specifications)

### 4.1. 웰컴 페이지 (Welcome Page)
- **UI 구성**:
  -   게임 타이틀 (`## 베네치아 Typing Ranking ##`)
  -   닉네임 입력 필드 (Label: `닉네임`)
  -   '닉네임 저장' 체크박스
  -   단계 선택 드롭다운 메뉴 (1~10단계)
  -   `[게임 시작하기]` 버튼
  -   `[랭킹 조회]` 버튼
- **요구사항**:
  -   **닉네임 저장**: 로컬에 저장하여 다음 실행 시 자동 완성.
  -   **랭킹 조회 버튼 기능**:
    -   클릭 시 **'랭킹 조회 모달'**이 열립니다.
    -   모달에는 Supabase DB에서 불러온 **상위 10명의 랭킹**과 **현재 접속한 닉네임의 최고 기록**이 표시됩니다. (표시항목 : 랭킹 | 닉네임 | 총 플레이 시간 | 점수)
    -   **표시 로직**:
      1.  **내 기록이 10위 밖인 경우**: 상위 10위 랭킹 리스트를 모두 보여주고, 그 아래에 구분선을 넣어 `[내 최고 기록] 순위: 15위 | 닉네임: Player1 | 점수: 12,000` 과 같이 별도로 표시합니다.
      2.  **내 기록이 10위 안인 경우**: 상위 10위 랭킹 리스트 안의 **내 기록에만 특별한 배경색이나 글자색으로 하이라이트**를 줍니다. 별도의 '내 최고 기록' 표시는 하지 않습니다.

### 4.2. 게임 페이지 (Game Page)
- **UI 구성**
  -   **상단 상태 바**: `현재 단계`, `점수`, `남은 기회 블록 수`, `총 플레이 시간(스톱워치, MM:SS.s 형식)`을 표시합니다.
  -   **중앙 게임 영역**: 하늘에서 단어들이 떨어지는 주 화면입니다.
  -   **하단 입력 영역**:
    -   12개의 '기회 블록' 이미지 위에 반투명한 사용자 단어 입력창이 위치합니다.
- **요구사항**:
  -   **총 플레이 시간(스톱워치, MM:SS.s 형식)**: 게임 시작과 동시에 전체 플레이 시간을 측정하며, 게임 종료 시 멈춥니다.
  -   **단계 클리어 및 진행**:
    -   **클리어 조건**: 각 단계마다 DB(`stage_settings`)에 설정된 시간(기본 60초)동안 생존하면 해당 단계를 클리어합니다.
    -   **단계 전환 UI**: 클리어 시간이 되면 게임이 잠시 멈추고, 화면 중앙에 `2단계로 넘어갑니다.`와 같은 모달 팝업이 나타납니다. 팝업에는 **3초 카운트다운**이 표시됩니다.
    -   **다음 단계 시작**: 카운트다운이 끝나면 모달이 사라지고, 다음 단계의 설정값(단어 하강 속도, 클리어 시간 등)을 적용하여 게임이 자동으로 재개됩니다.
    -   **기회 블록 유지**: **단계를 클리어하고 다음 단계로 넘어가도, 이미 부서진 기회 블록은 복구되지 않습니다. 남은 블록 수가 그대로 유지됩니다.**
  - **단어 생성 로직**:
    -   게임에 등장하는 모든 단어는 **Supabase DB의 `words` 테이블**에서 관리됩니다.
    -   게임 시작 및 매 단계가 시작될 때, 현재 단계(Stage)의 레벨에 맞는 단어 목록을 DB에서 불러와 사용합니다. 이를 통해 단어의 추가, 수정, 난이도 조절을 코드 수정 없이 유연하게 관리할 수 있습니다.
  -   **단어 타겟팅 규칙**: 사용자의 입력은 화면에 있는 모든 단어와 실시간으로 비교되며, 일치하는 모든 단어가 제거되고 제거된 단어의 수만큼 점수를 획득합니다.
  -   **점수 시스템**: 점수 계산은 (추정 키입력 수 * 현재 단계 * 10점) + 예시(‘어제’=4, ‘yesterday’=9).` 공식을 적용합니다.
  -   **단어 하강 속도 와 단어 출현 속도**:
      -   단어가 출현한 뒤 바닥에 닿기까지 걸리는 시간은 단계별로 다르며, 이 값은 게임 시작 및 단계 전환 시 Supabase DB에서 불러와 적용합니다.
      -   단어가 출현하는 속도(새로운 단어가 출현한 이후 다음 단어가 출현하는데 걸리는 시간)가 단계별로 다르며, 이 값은 게임 시작 및 단계 전환 시 Supabase DB에서 불러와 적용합니다.
    -   초기 설정값은 다음과 같습니다.
| 단계 | 소요 시간 (초) | 출현 속도 (초) |
| :--: | :---: | :--- |
| 1단계 | 28.95 | 3.0 |
| 2단계 | 24.85 | 2.5 |
| 3단계 | 20.71 | 2.1 |
| 4단계 | 16.64 | 1.7 |
| 5단계 | 13.84 | 1.3 |
| 6단계 | 12.47 | 1.0 |
| 7단계 | 9.71 | 0.8 |
| 8단계 | 8.33 | 0.6 |
| 9단계 | 6.30 | 0.4 |
| 10단계 | 4.20 | 0.3 |

### 4.3. 게임 종료 및 랭킹 표시 (Game Over & Ranking Display)
- **UI 구성**:
  -   게임 종료 시 **모달(팝업) 창**이 나타납니다.
  -   **최종 점수 표시**: `이번 기록: 15,800` 과 같이 이번 게임의 최종 점수를 상단에 표시합니다.
  -   **온라인 랭킹 리스트 (Top 10)**: `순위 | 닉네임 | 총 플레이 시간 | 점수` 형식의 리스트를 표시합니다.
  -   **버튼**: `[다시하기]`, `[메인으로]` 버튼을 제공합니다.
- **요구사항**:
  -   **버튼 기능 정의**:
    -   `[다시하기]`: 모달 창을 닫고, **웰컴 페이지**로 돌아가 바로 다음 게임을 준비할 수 있게 합니다.
    -   `[메인으로]`: 모달 창을 닫고, **웰컴 페이지**로 돌아가 게임 세션을 종료합니다. (두 버튼 모두 동작은 동일하게 웰컴 페이지로 이동)
  -   **랭킹 시스템 연동 로직**:
    1.  게임이 종료되면, 현재 게임의 `{닉네임, 총 플레이 시간, 점수}`를 Supabase DB로 전송하여 점수기준으로 **신기록인 경우에만 업데이트**를 요청합니다.
    2.  업데이트된 DB로부터 **최신 상위 10명의 랭킹**과 **방금 플레이한 나의 최종 순위**를 받아옵니다.
    3.  모달 창에 랭킹을 표시합니다.
  -   **랭킹 표시 로직**:
    1.  **내 이번 기록이 10위 밖인 경우**: 상위 10위 랭킹 리스트를 모두 보여주고, 그 아래에 구분선을 넣어 `[내 기록] 순위: 12위 | 닉네임: Player1 | 총 플레이 시간 : 07:25.4 | 점수: 15,800점` 과 같이 별도로 표시합니다.
    2.  **내 이번 기록이 10위 안인 경우**: 상위 10위 랭킹 리스트 안의 **내 기록에만 특별한 배경색이나 글자색으로 하이라이트**를 줍니다. 별도의 '내 기록' 표시는 하지 않습니다.

### 4.4. 관리자 페이지 (Admin Page)
- **접근**: `/admin` 경로를 통해 접근할 수 있습니다.
- **보안**: 안전한 접속을 위해 암호 인증을 통과해야만 페이지에 진입할 수 있습니다.
- **기능**: `stage_settings` 테이블에 저장된 게임의 핵심 밸런스 값들(하강 시간, 출현 속도, 단계별 게임 시간)을 웹 인터페이스를 통해 직접 수정하고 DB에 즉시 반영할 수 있습니다.

---

## 5. 데이터 모델 (Supabase & Local Storage)
- **설명**: 사용자의 편의성을 위한 데이터는 로컬에, 경쟁 및 게임 밸런스를 위한 데이터는 Supabase DB에 저장하여 관리합니다.

### 5.1. 로컬 저장소 (Local Storage)
- **목적**: 브라우저에 사용자 개인의 설정 정보를 저장.
- **데이터 필드**: **사용자 정보 (`user_data`)**
  - **saved_nickname** (text): 마지막으로 저장된 사용자 닉네임.
  - **save_preference** (boolean): 닉네임 저장 여부 (true/false).

### 5.2. 수파베이스 (Supabase)
- **목적**: 모든 사용자의 점수 기록, 게임 설정값 등을 저장하고 관리하는 중앙 데이터베이스.
- **테이블 1**: **스코어 (`scores`)**
  - **nickname** (text): 기본 키(Primary Key), 중복 불가(Unique). 사용자 닉네임.
  - **play_at** (text): 사용자가 플레이 한 시간. (MM:SS.s 형식)
  - **score** (int): 해당 닉네임의 최고 점수.
  - **updated_at** (timestamp): 기록이 마지막으로 업데이트된 시간.
- **테이블 2**: **게임 설정 (`stage_settings`)**
  - **stage_level** (int): 기본 키(Primary Key). 1부터 10까지의 단계.
  - **fall_duration_seconds** (float): 해당 단계의 단어 하강 소요 시간(초).
  - **clear_duration_seconds** (int): **해당 단계를 클리어하는 데 필요한 생존 시간(초). 기본값 60.**
- **테이블 3**: **단어 (`words`)**
  - **id** (int): 기본 키(Primary Key).
  - **text** (text): 단어의 내용.
  - **min_level** (int): 이 단어가 등장할 수 있는 **최소 레벨**.
  - **max_level** (int): 이 단어가 등장할 수 있는 **최대 레벨**.
- **기능**:
  -   **점수 관리**: 게임 종료 후 점수 전송 시, RPC를 사용하여 기존 점수보다 높을 경우에만 `scores` 테이블을 업데이트합니다.
  -   **설정 관리**: 게임 시작 및 단계 전환 시, `stage_settings` 테이블에서 현재 단계에 맞는 설정값들을 불러와 게임에 적용합니다.

---

## 6. 향후 확장 계획 (Future Enhancements)  : MVP에 포함되지 않으며, MVP 완성 이후 진행할 작업 계획.
- **게임 중 나타나는 다양한 효과 적용**: 중간에 랜덤하게 노란색 단어가 나타나기도 하며 이 단어를 정확하게 입력하면 아래 열거한 9가지 바이러스 중 하나가 무작위로 발동됩니다. 이 노란색 단어는 바닥에 닿아도 기회블럭을 파괴하지 않습니다. 바이러스가 발동 중인 동안 바이러스 이름을 오른쪽 상단 화면에 표시합니다. (카운트 다운이 필요한 경우 여기에 함께 표시됨)
그리고 동작중인 모든 바이러스는 현재 단계가 끝날 경우, 해제됩니다.
  - 1) **싹쓸이 바이러스:** 화면에 떨어지고 있는 모든 단어를 제거합니다. 가장 아래쪽에 있는 단어부터 순차적으로 지워지며 모든 단어가 사라지면 다시 하나씩 출현합니다. 이때 지워진 단어는 모두 점수로 계산되어 적용됩니다.
  - 2) **마취 바이러스:** 화면에 있는 모든 단어들이 잠시 동안 움직임(낙하)을 멈춥니다. 멈추는 시간은 5초이며 화면에 카운트 다운이 표시됩니다. 이때 유저는 단어를 타이핑하여 없앨 수 있습니다.
  - 3) **재건 바이러스:** 부서진 하단 기회블록을 모두 복구합니다. 12개가 온전한 상태가 되는 것입니다.
  - 4) **날쌘 바이러스:** 단어들이 내려오는 속도가 빨라집니다. 현 단계 속도보다 50% 빨라지고 5초 동안 지속되며 이후 원래 속도로 돌아갑니다. 화면에 카운트 다운이 표시됩니다.
  - 5) **굼벵이 바이러스:** 단어들이 내려오는 속도가 잠시 느려집니다. 1 단계 속도로 5초 동안 유지되며 이후 원래 속도로 돌아갑니다. 화면에 카운트 다운이 표시됩니다.
  - 6) **숨바꼭질 바이러스:** 일정 시간 동안 모든 단어들이 보이지 않게 됩니다. (떨어지던 단어가 "????"로 치환되고 하강은 유지. 신규 단어는 정상표시) 5초 동안 지속되며 ????의 원래 단어를 하나라도 올바르게 입력하면 즉시 모든 단어가 원래대로 보여집니다.
  - 7) **패거리 바이러스:** 순간적으로 많은 단어가 쏟아져 나옵니다. 총 5개의 단어가 한꺼번에 더 생성된다. 단어가 겹쳐보이지 않아야 한다.
  - 8) **지뢰 바이러스:** 노란색 단어를 없앤 자리에 지뢰가 설치되어, 다른 단어가 지뢰에 닿으면 그 단어를 없애줍니다. 점수도 계산됩니다.
  - 9) **에이즈 바이러스:** 이 효과를 가진 노란 단어를 놓치면, 해당 단계가 끝날 때까지 다른 노란 단어들도 일반 단어처럼 기회블록을 파괴하는 페널티가 생깁니다. 노란색 단어는 기회블럭을 파괴하지 않는다는 점을 악용하여 계속 스킵하는 유저에게 패널티를 제공하기 위한 바이러스 입니다.
- **다양한 랭킹 보드**: 주간/월간 랭킹, 친구 랭킹 등 다양한 종류의 랭킹 보드를 추가하여 경쟁의 재미를 더합니다.
- **사용자 인증 시스템 도입**: 닉네임 중복 및 도용을 방지하기 위해 이메일/소셜 로그인 등 정식 사용자 인증 시스템을 도입합니다.